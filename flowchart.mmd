---
config:
  theme: default
  layout: td
---

flowchart TD

%% /display-itinerary Flow
A["User Uploads Ticket"] --> B["/display-itinerary"]
B --> C["OCR + Cleanup"]
C --> D["Gemma: Extract Travel Info + Edge Distance"]
D --> E{"Preferences?"}

E -- No --> F["Skip to Prompt"]
E -- Yes --> G["Gemma: Extract Keywords"]
G --> H["SearxNG: Search POIs, Hotels, etc."]
F --> H

H --> I{"Results Found?"}
I -- Yes --> J["Build Prompt with Results"]
I -- No --> K["Fallback Prompt"]
J --> L["Generate & Return Itinerary"]
K --> L

%% /ask Flow (Compact)
L --> M["/ask ‚Üí Context + Query"]
M --> N["Searx + Build Prompt"]
N --> O["Gemma ‚Üí Answer"]
O --> P["Return Response"]

%% üé® Class Definitions
classDef input fill:#FF7043,stroke:#FF3D00,color:#000;
classDef process fill:#2A2A2A,stroke:#757575,color:#ffffff;
classDef llm fill:#7E57C2,stroke:#B39DDB,color:#fff;
classDef external fill:#FFCA28,stroke:#FFB300,color:#000;
classDef decision fill:#EF5350,stroke:#E53935,color:#fff;
classDef output fill:#69F0AE,stroke:#00E676,color:#000;



%% üè∑Ô∏è Assign Classes
class A,B,M input
class C,F,J,K process
class D,G,O llm
class H,N external
class E,I decision
class L,P output
